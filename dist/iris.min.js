/*! iris 2013-03-24 */
IRIS={},IRIS.ctrl={init:!1},IRIS.start=function(){for(var t in IRIS.ctrl.ds)IRIS.ctrl.ds[t].firstCall?IRIS.ctrl.ds[t].requestData():IRIS.ctrl.ds[t].auto&&(IRIS.ctrl.ds.auto[IRIS.ctrl.ds[t].id]=setTimeout('IRIS._requestDatasource("'+IRIS.ctrl.ds[t].id+'", {})',IRIS.ctrl.ds[t].rate));IRIS.ctrl.init=!0},IRIS.ctrl.ds={},IRIS.ctrl.ds.auto={},IRIS.createDatasource=function(t,e){var r=!1;if("string"==typeof t&&"object"==typeof e&&"string"==typeof e.uri?r=t:"object"==typeof t&&"string"==typeof t.id&&(e=t,r=t.id),t instanceof Array){for(var s=[],i=0;t.length>i;i++)t[i]instanceof Array||"string"!=typeof t[i].id||"string"!=typeof t[i].uri?s.push(!1):s.push(IRIS.createDatasource(t[i]));return s}return r!==!1&&"string"==typeof e.uri?(e.id=r,IRIS._createDatasource(e)):!1},IRIS.DS_MODE_AJAX=1,IRIS.DS_MODE_FILE=2,IRIS.DS_MODE_OBJECT=3,IRIS._defaultDatasource={mode:IRIS.DS_MODE_AJAX,modeOptions:{method:"GET",data:{}},auto:!1,rate:5e3,timeout:0,firstCall:!0,jsonp:"",beforeSend:null,success:null,error:null,complete:null},IRIS._createDatasource=function(t){t=$.extend(!0,{},IRIS._defaultDatasource,t);var e=new IRIS.Datasource(t);return IRIS.ctrl.ds[e.id]===void 0?(IRIS.ctrl.ds[e.id]=e,IRIS.ctrl.init&&(e.firstCall?e.requestData():e.auto&&(IRIS.ctrl.ds.auto[e.id]=setTimeout('IRIS._requestDatasource("'+e.id+'", {})',e.rate))),e):!1},IRIS._requestDatasource=function(t){if(IRIS.ctrl.ds[t]instanceof IRIS.Datasource&&!IRIS.ctrl.ds[t]._request){var e=IRIS.ctrl.ds[t];switch("function"==typeof e.beforeSend&&e.beforeSend(e),e._request=!0,e.mode){case IRIS.DS_MODE_AJAX:IRIS._requestDatasourceAjax(e);break;case IRIS.DS_MODE_FILE:break;case IRIS.DS_MODE_OBJECT:}}return!1},IRIS._requestDatasourceAjax=function(t,e){var r="GET",s={};"object"==typeof t.modeOptions&&"string"==typeof t.modeOptions.method&&(r=t.modeOptions.method),"object"==typeof t.modeOptions.data&&(s=t.modeOptions.data),s=$(!0,e,s);var i={url:t.uri,type:r,dataType:"json",data:s,success:IRIS._requestDatasourceAjaxSuccess,error:IRIS._requestDatasourceAjaxError,complete:IRIS._requestDatasourceAjaxComplete,context:t};"string"==typeof t.jsonp&&""!==t.jsonp&&(i.dataType="jsonp",i.jsonp=t.jsonp),t.timeout>0&&(i.timeout=t.timeout),$.ajax(i)},IRIS._requestDatasourceAjaxSuccess=function(t){"function"==typeof this.success&&this.success(t,this)},IRIS._requestDatasourceAjaxError=function(){"function"==typeof this.error&&this.error(this)},IRIS._requestDatasourceAjaxComplete=function(){this._request=!1,this.auto&&(IRIS.ctrl.ds.auto[this.id]=setTimeout('IRIS._requestDatasource("'+this.id+'", {})',this.rate)),"function"==typeof this.complete&&this.complete(this)},IRIS.Datasource=function(t){this.id=t.id,this.uri=t.uri,this.mode=t.mode,this.modeOptions=t.modeOptions,this.auto=t.auto,this.rate=t.rate,this.timeout=t.timeout,this.firstCall=t.firstCall,this.jsonp=t.jsonp,this.beforeSend=t.beforeSend,this.success=t.success,this.error=t.error,this.complete=t.complete,this._request=!1},IRIS.Datasource.prototype={_readOnlyFields:["id","uri","mode"],requestData:function(t){IRIS._requestDatasource(this.id,t)},get:function(t){return this[t]},set:function(t,e){return this._readOnlyFields.indexOf(t)>-1?!1:(this[t]=e,!0)}},IRIS.ctrl.ent={},IRIS.ctrl.dsEntRel={},IRIS.createEntity=function(t,e){var r=!1;if("string"==typeof t?(r=t,e===void 0&&(e={})):"object"==typeof t&&"string"==typeof t.id&&(e=t,r=t.id),t instanceof Array){for(var s=[],i=0;t.length>i;i++)t[i]instanceof Array?s.push(!1):s.push(IRIS.createEntity(t[i]));return s}return r!==!1?(e.id=r,e.ds===void 0&&(e.ds=r),IRIS._createEntity(e)):!1},IRIS.setEntityPath=function(t,e,r){IRIS.ctrl.dsEntRel[e]===void 0&&(IRIS.ctrl.dsEntRel[e]={}),"string"==typeof IRIS.ctrl.dsEntRel[e][t]?delete IRIS.ctrl.dsEntRel[e][t]:IRIS.ctrl.dsEntRel[e][t]=r},IRIS.getEntityPath=function(t,e){return IRIS.ctrl.dsEntRel[e]!==void 0&&IRIS.ctrl.dsEntRel[e][t]!==void 0?IRIS.ctrl.dsEntRel[e][t]:!1},IRIS._defaultEntity={index:"",exclude:"",lifespan:-1,beforeCreate:null,create:null,beforeDelete:null},IRIS._createEntity=function(t){var e=!1;if(t=$.extend(!0,{},IRIS._defaultEntity,t),e=new IRIS.Entity(t),IRIS.ctrl.ent[e.id]===void 0)if(IRIS.ctrl.ent[e.id]=e,e.ds instanceof Array)for(var r in e.ds)IRIS.getEntityPath(e.id,e.ds)===!1&&IRIS.setEntityPath(e.id,e.ds[r],"");else IRIS.getEntityPath(e.id,e.ds)===!1&&IRIS.setEntityPath(e.id,e.ds,"");else e=!1;return e},IRIS.Entity=function(t){this.id=t.id,this.ds=t.ds,this.index=t.index,this.exclude=t.exclude,this.lifespan=t.lifespan,this.beforeCreate=t.beforeCreate,this.create=t.create,this.beforeDelete=t.beforeDelete},IRIS.Entity.prototype={_readOnlyFields:["id","index"],requestData:function(t){IRIS._requestDatasource(this.id,t)},get:function(t){return this[t]},set:function(t,e){return this._readOnlyFields.indexOf(t)>-1?!1:(this[t]=e,!0)}};