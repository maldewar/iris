/*! iris 2013-06-02 */
IRIS={},IRIS.ctrl={init:!1,evCount:0},IRIS.fn={},IRIS.start=function(t){for(var e in IRIS.ctrl.ds)IRIS.ctrl.ds[e].firstCall?IRIS.ctrl.ds[e].requestData():IRIS.ctrl.ds[e].auto&&(IRIS.ctrl.ds.auto[IRIS.ctrl.ds[e].id]=setTimeout('IRIS._requestDatasource("'+IRIS.ctrl.ds[e].id+'", {})',IRIS.ctrl.ds[e].rate));IRIS.ctrl.init=!0;var i="";"object"==typeof t&&"string"==typeof t.engine?i=t.engine:"string"==typeof t&&(i=t),""!==i&&IRIS.ctrl.engine[i]!==void 0&&new IRIS.ctrl.engine[i]},IRIS._isUndef=function(t){return t===void 0},IRIS._areEqual=function(t,e){return JSON.stringify(t)==JSON.stringify(e)},IRIS._isObject=function(t){return"object"==typeof t&&!(t instanceof Array)},IRIS._isArray=function(t){return t instanceof Array},IRIS._valueToArray=function(t){return t instanceof Array?t:t!==void 0?[t]:[]},IRIS._random=function(t,e){return(e-t)*Math.random()+t},IRIS._bindEvent=function(t,e){return"function"==typeof e?(IRIS.fn[t]===void 0&&(IRIS.fn[t]={}),IRIS.fn[t][IRIS.ctrl.evCount]=e,IRIS.ctrl.evCount++,!0):!1},IRIS._triggerEvent=function(t,e,i,n,s,r,I){if(IRIS.fn[t]!==void 0)for(var o in IRIS.fn[t])IRIS.fn[t][o](e,i,n,s,r,I)},IRIS._setterUndef=function(t,e){return t===void 0?e:t},IRIS._setterVector2=function(t,e){return t instanceof IRIS.Vector2?t:"object"==typeof t?new IRIS.Vector2(t.x,t.y):e},IRIS._setterVector3=function(t,e){return t instanceof IRIS.Vector3?t:"object"==typeof t?new IRIS.Vector3(t.x,t.y,t.z):e},function(){var t=!1,e=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(i){function n(){!t&&this.init&&this.init.apply(this,arguments)}var s=this.prototype;t=!0;var r=new this;t=!1;for(var I in i)r[I]="function"==typeof i[I]&&"function"==typeof s[I]&&e.test(i[I])?function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(I,i[I]):i[I];return n.prototype=r,n.prototype.constructor=n,n.extend=arguments.callee,n}}(),IRIS.ctrl.asset={},IRIS.ctrl.assetIns={},IRIS.ctrl.entAssetRel={},IRIS.EV_ASSET_REGISTERED="registered",IRIS.EV_ASSET_UNREGISTERED="unregistered",IRIS.EV_ASSET_CREATED="created",IRIS.EV_ASSET_UPDATED="updated",IRIS.EV_ASSET_DELETED="deleted",IRIS.Asset=function(t){this.id=t.id,this.index=IRIS._setterUndef(t.index),this.object=IRIS._setterUndef(t.object),this.data=IRIS._setterUndef(t.data),this.position=!1,this.rotation=!1,this.size=!1,this.scale=1,this.parent=!1,this.style=[],this.state=[],this.createModifier=IRIS._setterUndef(t.createModifier,!1),this.updateModifier=IRIS._setterUndef(t.updateModifier,!1),this.deleteModifier=IRIS._setterUndef(t.deleteModifier,!1)},IRIS.Asset.prototype={set:function(){},pushState:function(){},pullState:function(){}},IRIS.assetProvider=Class.extend({_assetIns:{},_entityAsset:{},_assetOpts:{},init:function(t){if(IRIS._isObject(t))for(var e in t)t[e]=this._normalizeOpts(e,t[e]),this._registerEntityAssetRel(e,t[e].entity),this._registerAssetOpts(e,t[e])},getAsset:function(t,e,i){if(this._assetIns[i.id]!==void 0&&this._assetIns[i.id][t]!==void 0)return this._assetIns[i.id][t];var n=this.getAssetId(t,e,i),s=this.getAssetOpts(n),r=new IRIS.Asset({id:n,index:t,object:this.getAssetObject(t,e,i),createModifier:s.create,updateModifier:s.update,deletemodifier:s.delete,data:e});return r},getAssetId:function(t,e,i){return IRIS._isUndef(this._entityAsset[i.id])?!1:this._entityAsset[i.id]},getAssetOpts:function(t){return IRIS._isUndef(this._assetOpts[t])?!1:this._assetOpts[t]},_normalizeOpts:function(t,e){return"object"==typeof e&&e.entity===void 0&&(e.entity=t),e.create=IRIS._valueToArray(e.create),e.update=IRIS._valueToArray(e.update),e.delete=IRIS._valueToArray(e.delete),e},_registerEntityAssetRel:function(t,e){IRIS._isUndef(this._entityAsset[t])?this._entityAsset[t]=e:IRIS._isArray(this._entityAsset[t])?this._entityAsset[t].push(e):this._entityAsset[t]=[this._entityAsset[t],e]},_registerAssetOpts:function(t,e){this._assetOpts[t]=e}}),IRIS.ctrl.assetProvider={},IRIS.registerAssetProvider=function(t,e){IRIS.ctrl.assetProvider[e]=t},IRIS.ctrl.ds={},IRIS.ctrl.ds.auto={},IRIS.createDatasource=function(t,e){var i=!1;if("string"==typeof t&&"object"==typeof e&&"string"==typeof e.uri?i=t:"object"==typeof t&&"string"==typeof t.id&&(e=t,i=t.id),t instanceof Array){for(var n=[],s=0;t.length>s;s++)t[s]instanceof Array||"string"!=typeof t[s].id||"string"!=typeof t[s].uri?n.push(!1):n.push(IRIS.createDatasource(t[s]));return n}return i!==!1&&"string"==typeof e.uri?(e.id=i,IRIS._createDatasource(e)):!1},IRIS.DS_MODE_AJAX=1,IRIS.DS_MODE_FILE=2,IRIS.DS_MODE_OBJECT=3,IRIS._defaultDatasource={mode:IRIS.DS_MODE_AJAX,modeOptions:{method:"GET",data:{}},auto:!1,rate:5e3,timeout:0,firstCall:!0,jsonp:"",beforeSend:null,success:null,error:null,complete:null},IRIS._createDatasource=function(t){t=$.extend(!0,{},IRIS._defaultDatasource,t);var e=new IRIS.Datasource(t);return IRIS.ctrl.ds[e.id]===void 0?(IRIS.ctrl.ds[e.id]=e,IRIS.ctrl.init&&(e.firstCall?e.requestData():e.auto&&(IRIS.ctrl.ds.auto[e.id]=setTimeout('IRIS._requestDatasource("'+e.id+'", {})',e.rate))),e):!1},IRIS._requestDatasource=function(t){if(IRIS.ctrl.ds[t]instanceof IRIS.Datasource&&!IRIS.ctrl.ds[t]._request){var e=IRIS.ctrl.ds[t];switch("function"==typeof e.beforeSend&&e.beforeSend(e),e._request=!0,e.mode){case IRIS.DS_MODE_AJAX:IRIS._requestDatasourceAjax(e);break;case IRIS.DS_MODE_FILE:break;case IRIS.DS_MODE_OBJECT:}}return!1},IRIS._requestDatasourceAjax=function(t,e){var i="GET",n={};"object"==typeof t.modeOptions&&"string"==typeof t.modeOptions.method&&(i=t.modeOptions.method),"object"==typeof t.modeOptions.data&&(n=t.modeOptions.data),n=$(!0,e,n);var s={url:t.uri,type:i,dataType:"json",data:n,success:IRIS._requestDatasourceAjaxSuccess,error:IRIS._requestDatasourceAjaxError,complete:IRIS._requestDatasourceAjaxComplete,context:t};"string"==typeof t.jsonp&&""!==t.jsonp&&(s.dataType="jsonp",s.jsonp=t.jsonp),t.timeout>0&&(s.timeout=t.timeout),$.ajax(s)},IRIS._requestDatasourceAjaxSuccess=function(t){if("function"==typeof this.success&&this.success(t,this),IRIS.ctrl.dsEntRel[this.id]!==void 0)for(var e in IRIS.ctrl.dsEntRel[this.id])IRIS.ctrl.ent[e]!==void 0&&IRIS.createInstances(t,IRIS.ctrl.ent[e],IRIS.ctrl.dsEntRel[this.id][e])},IRIS._requestDatasourceAjaxError=function(){"function"==typeof this.error&&this.error(this)},IRIS._requestDatasourceAjaxComplete=function(){this._request=!1,this.auto&&(IRIS.ctrl.ds.auto[this.id]=setTimeout('IRIS._requestDatasource("'+this.id+'", {})',this.rate)),"function"==typeof this.complete&&this.complete(this)},IRIS.Datasource=function(t){this.id=t.id,this.uri=t.uri,this.mode=t.mode,this.modeOptions=t.modeOptions,this.auto=t.auto,this.rate=t.rate,this.timeout=t.timeout,this.firstCall=t.firstCall,this.jsonp=t.jsonp,this.beforeSend=t.beforeSend,this.success=t.success,this.error=t.error,this.complete=t.complete,this._request=!1},IRIS.Datasource.prototype={_readOnlyFields:["id","uri","mode"],requestData:function(t){IRIS._requestDatasource(this.id,t)},get:function(t){return this[t]},set:function(t,e){return this._readOnlyFields.indexOf(t)>-1?!1:(this[t]=e,!0)}},IRIS.Engine=Class.extend({init:function(){this.isRunning=!1,this.assetProvider=this._getAssetProviderInstance(this.assetProvider,IRIS.ui.asset),this.modifierProvider=this._getModifierProviderInstance(this.modifierProvider,IRIS.ui.modifier),this.scene=this.getScene(),this.scene.init(),IRIS.onEntityCreated(this._createAsset.bind(this)),IRIS.onEntityUpdated(this._updateAsset.bind(this)),IRIS.onEntityDeleted(this._deleteAsset.bind(this))},start:function(){this.isRunning=!0},pause:function(){this.isRunning=!1},_createAsset:function(t,e,i){var n=this.assetProvider.getAsset(t,e,i);this.modifierProvider.apply(n,n.createModifier),this.populateAsset(n),this.scene._addAsset(n)},_updateAsset:function(){},_deleteAsset:function(){},_getAssetProviderInstance:function(t,e){return IRIS.ctrl.assetProvider[t]!==void 0?new IRIS.ctrl.assetProvider[t](e):!1},_getModifierProviderInstance:function(t,e){return IRIS.ctrl.modifierProvider[t]!==void 0?new IRIS.ctrl.modifierProvider[t](e):!1}}),IRIS.Engine.TYPE_1D="1D",IRIS.Engine.TYPE_2D="2D",IRIS.Engine.TYPE_3D="3D",IRIS.ctrl.engine={},IRIS.registerEngine=function(t,e){IRIS.ctrl.engine[e]=t},IRIS.ctrl.ent={},IRIS.ctrl.entIns={},IRIS.ctrl.entObj={},IRIS.ctrl.dsEntRel={},IRIS.EV_ENTITY_REGISTERED="entityRegistered",IRIS.EV_ENTITY_UNREGISTERED="entityUnregistered",IRIS.EV_ENTITY_CREATED="entityCreated",IRIS.EV_ENTITY_UPDATED="entityUpdated",IRIS.EV_ENTITY_DELETED="entityDeleted",IRIS.createEntity=function(t,e){var i=!1;if("string"==typeof t?(i=t,e===void 0&&(e={})):"object"==typeof t&&"string"==typeof t.id&&(e=t,i=t.id),t instanceof Array){for(var n=[],s=0;t.length>s;s++)t[s]instanceof Array?n.push(!1):n.push(IRIS.createEntity(t[s]));return n}return i!==!1?(e.id=i,e.ds===void 0&&(e.ds=i),IRIS._createEntity(e)):!1},IRIS.setEntityPath=function(t,e,i){IRIS.ctrl.dsEntRel[e]===void 0&&(IRIS.ctrl.dsEntRel[e]={}),"string"==typeof IRIS.ctrl.dsEntRel[e][t]?delete IRIS.ctrl.dsEntRel[e][t]:IRIS.ctrl.dsEntRel[e][t]=i},IRIS.getEntityPath=function(t,e){return IRIS.ctrl.dsEntRel[e]!==void 0&&IRIS.ctrl.dsEntRel[e][t]!==void 0?IRIS.ctrl.dsEntRel[e][t]:!1},IRIS.deleteEntity=function(t,e){return IRIS.ctrl.entIns[t]!==void 0&&IRIS.ctrl.entIns[t][e]!==void 0?(delete IRIS.ctrl.entIns[t][e],delete IRIS.ctrl.entObj[t][e],IRIS._triggerEvent(IRIS.EV_ENTITY_DELETED,e,IRIS.ctrl.ent[t]),!0):!1},IRIS._defaultEntity={index:"",exclude:"",lifespan:-1,beforeCreate:null,create:null,beforeDelete:null},IRIS._createEntity=function(t){var e=!1;if(t=$.extend(!0,{},IRIS._defaultEntity,t),e=new IRIS.Entity(t),IRIS.ctrl.ent[e.id]===void 0){if(IRIS.ctrl.ent[e.id]=e,e.ds instanceof Array)for(var i in e.ds)IRIS.getEntityPath(e.id,e.ds)===!1&&IRIS.setEntityPath(e.id,e.ds[i],"");else IRIS.getEntityPath(e.id,e.ds)===!1&&IRIS.setEntityPath(e.id,e.ds,"");IRIS.ctrl.entIns[e.id]={},IRIS.ctrl.entObj[e.id]={}}else e=!1;return IRIS._triggerEvent(IRIS.EV_ENTITY_REGISTERED,e),e},IRIS.createInstances=function(data,oEntity,strPath){if(""!==strPath&&eval("data."+strPath)===void 0)return!1;var dataContainer=data;""!==strPath&&(dataContainer=eval("data."+strPath));for(var key in dataContainer)IRIS.createInstance(dataContainer[key],oEntity,key)},IRIS.createInstance=function(t,e,i){if(""!==$.trim(e.index)&&t[e.index]!==void 0&&(i=t[e.index]),"function"==typeof e.beforeCreate&&e.beforeCreate(i,t,e),"string"==typeof e.exclude&&""!==$.trim(e.exclude))delete t[e.exclude];else if(e.exclude instanceof Array)for(var n in e.exclude)delete t[e.exclude[n]];var s=IRIS.ctrl.entIns[e.id][i]===void 0;return(s||!IRIS._areEqual(IRIS.ctrl.entObj[e.id][i],t))&&(s?IRIS._triggerEvent(IRIS.EV_ENTITY_CREATED,i,t,e):IRIS._triggerEvent(IRIS.EV_ENTITY_UPDATED,i,IRIS.ctrl.entObj[e.id][i],t,e),IRIS.ctrl.entObj[e.id][i]=t,IRIS.ctrl.entIns[e.id][i]=t,"function"==typeof e.create&&e.create(i,t,e)),!1},IRIS.Entity=function(t){this.id=t.id,this.ds=t.ds,this.index=t.index,this.exclude=t.exclude,this.lifespan=t.lifespan,this.beforeCreate=t.beforeCreate,this.create=t.create,this.beforeDelete=t.beforeDelete},IRIS.Entity.prototype={_readOnlyFields:["id","index"],requestData:function(t){IRIS._requestDatasource(this.id,t)},get:function(t){return this[t]},set:function(t,e){return this._readOnlyFields.indexOf(t)>-1?!1:(this[t]=e,!0)}},IRIS.onEntityRegistered=function(t){return IRIS._bindEvent(IRIS.EV_ENTITY_REGISTERED,t)},IRIS.onEntityUnregistered=function(t){return IRIS._bindEvent(IRIS.EV_ENTITY_UNREGISTERED,t)},IRIS.onEntityCreated=function(t){return IRIS._bindEvent(IRIS.EV_ENTITY_CREATED,t)},IRIS.onEntityUpdated=function(t){return IRIS._bindEvent(IRIS.EV_ENTITY_UPDATED,t)},IRIS.onEntityDeleted=function(t){return IRIS._bindEvent(IRIS.EV_ENTITY_DELETED,t)},IRIS.SingleValueInitializer=Class.extend({min:0,max:1,type:"random",init:function(t){t=IRIS._setterUndef(t,{}),this.min=IRIS._setterUndef(t.min,this.min),this.max=IRIS._setterUndef(t.max,this.max)},getValue:function(){return this.min==this.max?this.max:Math.random()*(this.max-this.min)+this.min},run:function(t){this._run(t,this.getValue())}}),IRIS.DoubleValueInitializer=Class.extend({minA:0,maxA:1,minB:0,minB:1,type:"random",init:function(t){this.minA=IRIS._setterUndef(t.minA,this.minA),this.maxA=IRIS._setterUndef(t.maxA,this.maxA),this.minB=IRIS._setterUndef(t.minB,this.minB),this.maxB=IRIS._setterUndef(t.maxB,this.maxB)},getValue:function(){return{a:0,b:0,c:0}},run:function(t){this._run(t,this.getValue(this.minA,this.maxA),this.getValue(this.minB,this.maxB))}}),IRIS.TripleValueInitializer=IRIS.DoubleValueInitializer.extend({minC:0,maxC:1,type:"random",init:function(t){this._super(t),this.minC=IRIS._setterUndef(t.minC,this.minC),this.maxC=IRIS._setterUndef(t.maxC,this.maxC)},run:function(t){this._run(t,this.getValue(this.minA,this.maxA),this.getValue(this.minB,this.maxB),this.getValue(this.minC,this.maxC))}}),IRIS.MODIFIER_TARGET_POSITION="position",IRIS.MODIFIER_TARGET_SCALE="scale",IRIS.MODIFIER_TARGET_COLOR="color",IRIS.MODIFIER_TARGET_SIZE="size",IRIS.MODIFIER_TARGET_ROTATION="rotation",IRIS.Modifier=Class.extend({init:function(t){this.id=t.id,this.target=t.target,this.zone=IRIS.getZone(t.zone,t.zoneOpts)}}),IRIS.ModifierProvider=Class.extend({_modifierIns:{},_modifierOpts:{},init:function(t){if(IRIS._isObject(t))for(var e in t)t[e]=this._normalizeOpts(e,t[e]),this._registerModifierOpts(e,t[e])},getModifier:function(t){if(this._modifierIns[t]!==void 0)return this._modifierIns[t];var e=this.getModifierOpts(t);if(e){switch(e.target){default:var i=this._getModifier("id",e)}return this._modifierIns[t]=i,i}return!1},apply:function(t,e){for(var i in e)IRIS._isUndef(this._modifierOpts[e[i]])||(IRIS._isUndef(this._modifierIns[e[i]])&&(this._modifierIns[e[i]]=this._getModifierInstance(this._modifierOpts[e[i]])),this._modifierIns[e[i]].apply(t))},getModifierOpts:function(t){return IRIS._isUndef(this._modifierOpts[t])?!1:this._modifierOpts[t]},_getModifierInstance:function(t){switch(t.target){case IRIS.MODIFIER_TARGET_POSITION:return new IRIS.ThreejsPositionModifier(t);default:return!1}},_normalizeOpts:function(t,e){return"object"==typeof e&&e.id===void 0&&(e.id=t),e},_registerModifierOpts:function(t,e){this._modifierOpts[t]=e}}),IRIS.ctrl.modifierProvider={},IRIS.registerModifierProvider=function(t,e){IRIS.ctrl.modifierProvider[e]=t},IRIS.Scene=function(t){this.init=t.init,this.val=t.val,this.obj={},this.addAsset=t.addAsset,this.removeAsset=t.removeAsset,this.onFrame=t.onFrame,this.ctrl={asset:{}}},IRIS.Scene.prototype={getAsset:function(t,e){return this.ctrl.asset[e]!==void 0&&this.ctrl.asset[e][t]!==void 0?this.ctrl.asset[e][t]:!1},_addAsset:function(t){this.addAsset(t)},_removeAsset:function(){this.removeAsset()}},IRIS.ZONE_TYPE_LINE_2D="line2D",IRIS.ZONE_TYPE_CIRCLE="circle",IRIS.ZONE_TYPE_DISC="disc",IRIS.ZONE_TYPE_SIN="sin",IRIS.ZONE_TYPE_COS="cos",IRIS.ZONE_TYPE_TAN="tan",IRIS.ZONE_TYPE_SQUARE="square",IRIS.ZONE_TYPE_RECTANGLE="rectangle",IRIS.ZONE_TYPE_VERTEX="vertex",IRIS.ZONE_TYPE_LINE_3D="line3D",IRIS.ZONE_TYPE_SPHERE="sphere",IRIS.ZONE_TYPE_BALL="ball",IRIS.ZONE_TYPE_BOX="box",IRIS.ZONE_TYPE_CUBE="cube",IRIS.ZONE_TYPE_SPRING="spring",IRIS.ZONE_PATTERN_RANDOM=0,IRIS.ZONE_PATTERN_LINEAL=1,IRIS.ZONE_PLANE_XY="xy",IRIS.ZONE_PLANE_YX="yx",IRIS.ZONE_PLANE_YZ="yz",IRIS.ZONE_PLANE_ZY="zy",IRIS.ZONE_PLANE_XZ="xz",IRIS.ZONE_PLANE_ZX="zx",IRIS.BaseVectorZone=Class.extend({init:function(t){this.x=IRIS._setterUndef(t.x,0),this.y=IRIS._setterUndef(t.y,0),this.pattern=IRIS._setterUndef(t.pattern,IRIS.ZONE_PATTERN_RANDOM),this.step=IRIS._setterUndef(t.step,.1),this.scale=IRIS._setterUndef(t.scale,1)}}),IRIS.Vector2Zone=IRIS.BaseVectorZone.extend({init:function(t){this._super(t),this.plane=IRIS._setterUndef(t.plane,!1),this.plane?(this.rotation=IRIS._setterVector3(t.rotation,new IRIS.Vector3(0,0,0)),this.position=IRIS._setterVector3(t.position,new IRIS.Vector3(0,0,0))):(this.rotation=IRIS._setterVector2(t.rotation,new IRIS.Vector2(0,0)),this.position=IRIS._setterVector2(t.position,new IRIS.Vector2(0,0)))},_vector2ToPlane:function(t,e,i){switch(t instanceof IRIS.Vector2&&(i=e,e=t.y,t=t.x),i){case IRIS.ZONE_PLANE_YX:return new IRIS.Vector3(e,t,0);case IRIS.ZONE_PLANE_YZ:return new IRIS.Vector3(0,t,e);case IRIS.ZONE_PLANE_ZY:return new IRIS.Vector3(0,e,t);case IRIS.ZONE_PLANE_XZ:return new IRIS.Vector3(t,0,e);case IRIS.ZONE_PLANE_ZX:return new IRIS.Vector3(e,0,t);default:return new IRIS.Vector3(t,e,0)}}}),IRIS.Vector3Zone=IRIS.BaseVectorZone.extend({init:function(t){this._super(t),this.z=IRIS._setterUndef(t.z,0),this.rotation=IRIS._setterVector3(t.rotation,new IRIS.Vector3(0,0,0)),this.position=IRIS._setterVector3(t.position,new IRIS.Vector3(0,0,0))}}),IRIS.ctrl.zone={},IRIS.registerZone=function(t,e){IRIS.ctrl.zone[e]=t},IRIS.getZone=function(t,e){return IRIS._isUndef(IRIS.ctrl.zone[t])?!1:new IRIS.ctrl.zone[t](e)},IRIS.VertexZone=IRIS.Vector2Zone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),IRIS._isUndef(t.vertices)||this.setVertices(t.vertices),this._stepVector=0},setVertices:function(t){var e=new IRIS.Vector2(0,0);if(IRIS._isArray(t)){for(var i in t)t[i]=IRIS._setterVector2(t[i],e),this.plane&&(t[i]=this._vector2ToPlane(t[i],this.plane));this.vertices=t,this._lengths=[],this._sumLengths=[],this._length=0;for(var n,s=0;this.vertices.length>s;s++){n=s==this.vertices.length-1?this.vertices[0]:this.vertices[s+1];var r=this.vertices[s].dist(n);this._lengths.push(r),this._sumLengths.push(this._length),this._length+=r}}else this.vertices=!1},getStep:function(){return this.pattern==IRIS.ZONE_PATTERN_RANDOM?this._stepVector=IRIS._random(0,this._length):(this._stepVector+=this.step,this._stepVector>this._length&&(this._stepVector-=this._length)),this._getPointAtLength(this._stepVector)},_getPointAtLength:function(t){for(var e=0,i=0;this._sumLengths.length>=i&&t>this._sumLengths[i];i++)e=i;var n=this.vertices[e];if(e==this.vertices.length-1)var s=this.vertices[0];else var s=this.vertices[e+1];var r=(t-this._sumLengths[e])/this._lengths[e];return n.pointTo(s,r).mul(this.scale)}}),IRIS.registerZone(IRIS.VertexZone,IRIS.ZONE_TYPE_VERTEX),IRIS.ScaleInitializer=IRIS.SingleValueInitializer.extend({init:function(t){this._super(t)},_run:function(t,e){t.scale=e}}),IRIS.CircleZone=IRIS.Vector2Zone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),this.radius=IRIS._setterUndef(t.radius,1),this._stepVector=0},getStep:function(){if(this.pattern==IRIS.ZONE_PATTERN_RANDOM)var t=2*Math.PI*Math.random();else{var t=this._stepVector;this._stepVector+=this.step}return new IRIS.Vector3(this.radius*Math.cos(t)*this.scale+this.x,this.radius*Math.sin(t)*this.scale+this.y,0)}}),IRIS.registerZone(IRIS.CircleZone,IRIS.ZONE_TYPE_CIRCLE),IRIS.Line2DZone=IRIS.Vector2Zone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),this.toX=IRIS._setterUndef(t.toX,1),this.toY=IRIS._setterUndef(t.toY,1),this.plane?(this._start=this._vector2ToPlane(this.x,this.y,this.plane),this._end=this._vector2ToPlane(this.toX,this.toY,this.plane)):(this._start=new IRIS.Vector2(this.x,this.y),this._end=new IRIS.Vector2(this.toX,this.toY)),this._len=this._end.clone().sub(this._start),this._stepVector=0},getStep:function(){var t=this._len.clone();return this.pattern==IRIS.ZONE_PATTERN_RANDOM?t.mul(Math.random()):(t.mul(this._stepVector),this._stepVector+=this.step),t.add(this._start).mul(this.scale)}}),IRIS.registerZone(IRIS.Line2DZone,IRIS.ZONE_TYPE_LINE_2D),IRIS.Line3DZone=IRIS.Vector3Zone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),this.toX=IRIS._setterUndef(t.toX,1),this.toY=IRIS._setterUndef(t.toY,1),this.toZ=IRIS._setterUndef(t.toZ,1),this._start=new IRIS.Vector3(this.x,this.y,this.z),this._end=new IRIS.Vector3(this.toX,this.toY,this.toZ),this._len=this._end.clone().sub(this._start),this._stepVector=0},getStep:function(){var t=this._len.clone();return this.pattern==IRIS.ZONE_PATTERN_RANDOM?t.mul(Math.random()):(t.mul(this._stepVector),this._stepVector+=this.step),t.add(this._start).mul(this.scale)}}),IRIS.registerZone(IRIS.Line3DZone,IRIS.ZONE_TYPE_LINE_3D),IRIS.RectangleZone=IRIS.VertexZone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),this.lengthX=IRIS._setterUndef(t.lengthX,1),this.lengthY=IRIS._setterUndef(t.lengthY,1);var e=[{x:this.x+this.lengthX/2,y:this.y+this.lengthY/2},{x:this.x-this.lengthX/2,y:this.y+this.lengthY/2},{x:this.x-this.lengthX/2,y:this.y-this.lengthY/2},{x:this.x+this.lengthX/2,y:this.y-this.lengthY/2}];this.setVertices(e)},getStep:function(){return this._super()}}),IRIS.registerZone(IRIS.RectangleZone,IRIS.ZONE_TYPE_RECTANGLE),IRIS.SphereZone=IRIS.Vector3Zone.extend({init:function(t){t=IRIS._setterUndef(t,{}),this._super(t),this.radius=IRIS._setterUndef(t.radius,1),this._stepVector=0},getStep:function(){if(this.pattern==IRIS.ZONE_PATTERN_RANDOM)var t=2*Math.PI*Math.random(),e=t;else{var t=this._stepVector,e=this._stepVector;this._stepVector+=this.step}return new IRIS.Vector3(this.radius*Math.cos(e)*Math.sin(t)*this.scale+this.x,this.radius*Math.sin(e)*Math.sin(t)*this.scale+this.y,this.radius*Math.cos(t)*this.scale+this.z)}}),IRIS.registerZone(IRIS.SphereZone,IRIS.ZONE_TYPE_SPHERE),IRIS.ThreejsAssetProvider=IRIS.assetProvider.extend({init:function(t){this._super(t)},getAssetObject:function(t,e,i){var n=this.getAssetId(t,e,i),s=this.getAssetOpts(n);if(n===!1||s===!1)return!1;switch(s.type){case"sphere":return this.getSphere(s);default:return!1}},getCircle:function(){},getCube:function(){},getSphere:function(t){var e=new THREE.Mesh(new THREE.SphereGeometry(t.radius,t.segments,t.rings),new THREE.MeshLambertMaterial({color:14535884}));return e}}),IRIS.registerAssetProvider(IRIS.ThreejsAssetProvider,"threejs"),IRIS.ThreejsModifierProvider=IRIS.ModifierProvider.extend({init:function(t){this._super(t)},_getModifier:function(t){var e=new IRIS.Modifier({id:t,target:opts.target,zone:opts.zone,zoneOpts:opts.zoneOpts});return e}}),IRIS.registerModifierProvider(IRIS.ThreejsModifierProvider,"threejs"),IRIS.MODIFIER_TARGET_POSITION="position",IRIS.MODIFIER_TARGET_SCALE="scale",IRIS.MODIFIER_TARGET_COLOR="color",IRIS.MODIFIER_TARGET_SIZE="size",IRIS.MODIFIER_TARGET_ROTATION="rotation",IRIS.ThreejsPositionModifier=IRIS.Modifier.extend({init:function(t){this._super(t)},apply:function(t){var e=this.zone.getStep();t.position=e,t.object.position.x=e.x,t.object.position.y=e.y,t.object.position.z=e.z}}),IRIS.ui={},IRIS.ui.asset={},IRIS.Vector2=function(t,e){this.x=t?t:0,this.y=e?e:0},IRIS.Vector2.prototype={clone:function(){return new IRIS.Vector2(this.x,this.y)},length:function(){return Math.sqrt(this.length2())},length2:function(){return x*x+y*y},sub:function(t){return this.x-=t.x,this.y-=t.y,this},add:function(t){return this.x+=t.x,this.y+=t.y,this},nor:function(){return this.length(),0!==length&&(this.x/=length,this.y/=length),this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y+this.y*t.x},mul:function(t){return this.x*=t,this.y*=t,this},dist:function(t){var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},dist2:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},pointTo:function(t,e){var i=this.x+e*(t.x-this.x),n=this.y+e*(t.y-this.y);return new IRIS.Vector2(i,n)}},IRIS.Vector3=function(t,e,i){this.x=t?t:0,this.y=e?e:0,this.z=i?i:0},IRIS.Vector3.prototype={clone:function(){return new IRIS.Vector3(this.x,this.y,this.z)},length:function(){return Math.sqrt(this.length2())},length2:function(){return x*x+y*y+z*z},sub:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},nor:function(){return this.length(),0!==length&&(this.x/=length,this.y/=length,this.z/=length),this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},mul:function(t){return this.x*=t,this.y*=t,this.z*=t,this},dist:function(t){return Math.sqrt(this.dist2(t))},dist2:function(t){var e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return e*e+i*i+n*n},pointTo:function(t,e){var i=this.x+e*(t.x-this.x),n=this.y+e*(t.y-this.y),s=this.z+e*(t.z-this.z);return new IRIS.Vector3(i,n,s)}},IRIS.Color=function(t,e,i,n){this.r=t?t:0,this.g=e?e:0,this.b=i?i:0,this.a=n?n:1},IRIS.Color.prototype={},IRIS.State=function(t){this.id=t.id,this.style=t.style,this.easingIn=!1,this.easingOut=!1,this.lapseIn=0,this.lapseOut=0,this.durarion=300},IRIS.State.prototype={},IRIS.Easing={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return 1>(t*=2)?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return 1>(t*=2)?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:1>(t*=2)?.5*Math.pow(1024,t-1):.5*(-Math.pow(2,-10*(t-1))+2)}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return 1>(t*=2)?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),-(i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*2*Math.PI/n)))},Out:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*2*Math.PI/n)+1)},InOut:function(t){var e,i=.1,n=.4;return 0===t?0:1===t?1:(!i||1>i?(i=1,e=n/4):e=n*Math.asin(1/i)/(2*Math.PI),1>(t*=2)?-.5*i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*2*Math.PI/n):.5*i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*2*Math.PI/n)+1)}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return 1>(t*=2)?.5*t*t*((e+1)*t-e):.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-TWEEN.Easing.Bounce.Out(1-t)},Out:function(t){return 1/2.75>t?7.5625*t*t:2/2.75>t?7.5625*(t-=1.5/2.75)*t+.75:2.5/2.75>t?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return.5>t?.5*TWEEN.Easing.Bounce.In(2*t):.5*TWEEN.Easing.Bounce.Out(2*t-1)+.5}}},IRIS.VectorInitializer=Class.extend({init:function(){}}),IRIS.PositionInitializer=IRIS.VectorInitializer.extend({init:function(){}}),IRIS.ScaleInitializar=IRIS.VectorInitializer.extend({init:function(){}}),IRIS.RotationInitializar=IRIS.VectorInitializer.extend({init:function(){}}),IRIS.VelocityInitializer=IRIS.VectorInitializer.extend({init:function(){}}),IRIS.PlanetariumEngine=IRIS.Engine.extend({assetProvider:"threejs",assetProviderOpts:{},modifierProvider:"threejs",modifierProviderOpts:{},type:IRIS.Engine.TYPE_3D,init:function(t){this._super(t)},getScene:function(){return new IRIS.Scene({val:{width:window.innerWidth,height:window.innerHeight,cameraAngle:45,cameraNear:.1,cameraFar:1e4,fontNear:300,fontFar:700,fontSizeNear:1.1,fontSizeFar:.3,cameraZ:600},init:function(){this.obj.renderer=new THREE.WebGLRenderer,this.obj.camera=new THREE.PerspectiveCamera(this.val.cameraAngle,this.val.width/this.val.height,this.val.cameraNear,this.val.cameraFar),this.object=new THREE.Scene,this.object.add(this.obj.camera),this.obj.camera.position.z=this.val.cameraZ,THREE.Object3D._threexDomEvent.camera(this.obj.camera),this.obj.renderer.setSize(this.val.width,this.val.height);var t=new THREE.AmbientLight(1118481);this.object.add(t);var e=new THREE.DirectionalLight(16777215);e.position.set(1,1,1).normalize(),this.object.add(e),document.body.appendChild(this.obj.renderer.domElement),this.obj.clock=new THREE.Clock,this.obj.controls=new THREE.TrackballControls(this.obj.camera),this.obj.controls.rotateSpeed=2,this.obj.controls.zoomSpeed=2.2,this.obj.controls.panSpeed=1.6,this.obj.controls.noZoom=!1,this.obj.controls.noPan=!1,this.obj.controls.staticMoving=!0,this.obj.controls.dynamicDampingFactor=.3,this.obj.controls.keys=[65,83,68],this.obj.projector=new THREE.Projector,this.val.halfCanvasWidth=this.obj.renderer.domElement.width/2,this.val.halfCanvasHeight=this.obj.renderer.domElement.height/2,this.onFrame()},addAsset:function(t){this.object.add(t.object)},onFrame:function(){this.obj.controls.update(this.obj.clock.getDelta()),this.obj.renderer.render(this.object,this.obj.camera),requestAnimationFrame(this.onFrame.bind(this))}})},populateAsset:function(){}}),IRIS.registerEngine(IRIS.PlanetariumEngine,"planetarium");